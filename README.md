# 不要怀疑我编写脚本的专业性
这TM是ChatGPT写的！<br>
我只在CnetOS7.9上用，其他平台我没有测试，自行测试<br>
需要的环境：<br>

yum -y install nc

yum -y install jq

debian

sudo apt update
sudo apt install netcat jq


### 特别提示
你自己要先去创建一个二级域名才行，不然就是`失败`，这个脚本没有创建二级域名的功能哦<br>


## 专门针对流量转发搞得玩意儿

# 如果你不是CentOS的系统怎么办？
复制脚本代码扔到ChatGPT里面<br>
然后说：“以此为基础，我的系统平台是乌班图，请帮我修改成乌班图能使用的脚本，功能请保持不变！”<br>
就完事儿了！我只是以乌班图系统举例，你自己啥平台，就写啥系统<br>

# cloudflare_DNS
自动更新cloudflare_DNS域名解析
# Cloudflare API 凭据
auth_email="##########" #Cloudflare 邮箱

auth_key="##########" #Cloudflare  KEY

name=""  # 主域名

name_2=""  # 二级域名

content_cm1=""  # 端口开启时的 CNAME 记录值

content_cm2=""  # 端口关闭时的 CNAME 记录值

# 检查目标端口是否开启
   if nc -z -w 2 cm1.moni.cyou 49803 > /dev/null 2>&1; then
这里的主入口 cm1.moni.cyou 49803 需要修改的
  
## 场景
你流量转发买了多家 或 同一家，做了主备入口操作<br>
意思是：<br>
主广港隧道 A.12345.com:55555<br>
备沪港隧道 B.12345.com:55555<br>
入口不一样，但是端口一样<br>
### 效果
在终端用户什么都不修改的情况下，主要入口坏了，<br>
那么此时需要切换到备用上<br>
机场主原先操作：在后台修改节点的入口域名 缺点：用户需要刷新订阅<br>
个人用原先操作：我特么上不了了，我自己改下域名呗<br>
他人用户的操作：TMD什么破商家，又不能用了，TM几天了都没修改好（实际上机场主已经弄了，用户不会刷新）<br>
因此本方法来了！他来了，他来了，贼鸡儿靓的靓仔来了！<br>
随便准备个VPS，执行本脚本<br>
那么主入口不可用的时候，会自动解析备用入口，<br>
主入口连通的时候，又会自动解析回主入口。<br>
他人用户呢，什么都不修改，只需要等待域名解析好自然而然的久切换过去！<br>
这样就可以做到终端用户什么都不用修改。<br>
前提是 流量转发要做同样的端口<br>

## 举例
在某某家购买了流量转发，他们家拥有广州移动入口、上海电信入口 或者说 广港隧道、沪港隧道<br>
你要做的是，不同入口做同样出口！<br>
主广港隧道 A.12345.com:55555<br>
备沪港隧道 B.12345.com:55555<br>

### 在检查目标端口开启这里
  if nc -z -w 2 cm1.moni.cyou 49803 > /dev/null 2>&1; then
  
  修改成如下，注意域名和端口<br>
  
 if nc -z -w 2 A.12345.com 55555 > /dev/null 2>&1; then
  
  这个时候会监视 主广港隧道 的端口是否正常<br>
  如果正常的那就用这个主广港隧道，如果关闭了，会解析到 `备沪港隧道 B.12345.com:55555`<br>
  如果主入口修复了，会解析回`主广港隧道 A.12345.com:55555`
  
# 此时会有叼毛问 如何运行脚本
`./cloudflare_DNS.sh`
# 此时又会有叼毛问 如何后台运行脚本
`nohup ./cloudflare_DNS.sh`
然后关闭ssh窗口


# 特别注意
官方说：不能将此API用于具有.cf、.ga、.gq、.ml或.tk TLD（顶级域）的域<br>
大白话：上面的结尾的域名不能用API操作<br>
